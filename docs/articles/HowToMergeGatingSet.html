<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to merge/standardize GatingSets • flowWorkspace</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to merge/standardize GatingSets">
<meta property="og:description" content="flowWorkspace">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flowWorkspace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.3.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RGLab/flowWorkspace">
    <span class="fas fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="HowToMergeGatingSet_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to merge/standardize GatingSets</h1>
                        <h4 class="author">Greg Finak <a href="mailto:greg@ozette.ai" class="email">greg@ozette.ai</a>, Mike Jiang <a href="mailto:mike@ozette.ai" class="email">mike@ozette.ai</a>
</h4>
            
      
      
      <div class="hidden name"><code>HowToMergeGatingSet.Rmd</code></div>

    </div>

    
    
<div id="how-to-mergestandardize-gatingsets" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to-mergestandardize-gatingsets" class="anchor"></a>How to merge/standardize GatingSets</h1>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gs_split_by_tree.html">gs_split_by_tree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="../reference/gs_check_redundant_nodes.html">gs_check_redundant_nodes</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="../reference/gs_remove_redundant_nodes.html">gs_remove_redundant_nodes</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">toRemove</span><span class="op">)</span>
<span class="fu"><a href="../reference/gs_remove_redundant_channels.html">gs_remove_redundant_channels</a></span><span class="op">(</span><span class="va">gs</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
</div>
<div id="arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#arguments" class="anchor"></a>Arguments</h2>
<p><strong>x</strong><br>
‘GatingSet’ objects or or list of groups (each group member is a list of ’GatingSet`)</p>
<p><strong>toRemove</strong> list of the node sets to be removed. its length must equals to the length of argument <strong>x</strong></p>
<p><strong>…</strong> other arguments</p>
</div>
<div id="remove-the-redudant-leafterminal-nodes" class="section level2">
<h2 class="hasAnchor">
<a href="#remove-the-redudant-leafterminal-nodes" class="anchor"></a>Remove the redudant leaf/terminal nodes</h2>
<p><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-3-1.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-3-2.png" width="384"></p>
<p>Leaf nodes <strong>DNT</strong> and <strong>DPT</strong> are redudant for the analysis and should be <strong>removed</strong> before merging.</p>
</div>
<div id="hide-the-non-leaf-nodes" class="section level2">
<h2 class="hasAnchor">
<a href="#hide-the-non-leaf-nodes" class="anchor"></a>Hide the non-leaf nodes</h2>
<p><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-4-1.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-4-2.png" width="384"></p>
<p><strong>singlets</strong> node is not present in the second tree. But we <strong>can’t</strong> remove it because it will remove all its descendants. We can <strong>hide</strong> it instead.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/gs_pop_set_visibility.html">gs_pop_set_visibility</a></span><span class="op">(</span><span class="va">gs2</span>, <span class="st">"singlets"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">gs2</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">gs3</span><span class="op">)</span></code></pre></div>
<p><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-5-1.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-5-2.png" width="384"></p>
<p>Note that even gating trees look the same but <strong>singlets</strong> still physically exists so we must refer the populations by <strong>relative path</strong> (<code>path = "auto"</code>) instead of <strong>full path</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span><span class="op">(</span><span class="va">gs2</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span><span class="op">(</span><span class="va">gs3</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] "/not debris/singlets/CD3+/CD4/38- DR+"
## [1] "/not debris/CD3+/CD4/38- DR+"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span><span class="op">(</span><span class="va">gs2</span>, path <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>
<span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span><span class="op">(</span><span class="va">gs3</span>, path <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] "CD4/38- DR+"
## [1] "CD4/38- DR+"</code></pre>
</div>
<div id="isomorphism" class="section level2">
<h2 class="hasAnchor">
<a href="#isomorphism" class="anchor"></a>Isomorphism</h2>
<p><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-9-1.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-9-2.png" width="384"></p>
<p>These two trees are <strong>not identical</strong> due to the <strong>different order</strong> of <strong>CD4</strong> and <strong>CD8</strong>. However they are still mergable thanks to the <strong>reference by gating path</strong> instead of <code>by numeric indices</code></p>
</div>
<div id="convenient-wrapper-for-merging" class="section level2">
<h2 class="hasAnchor">
<a href="#convenient-wrapper-for-merging" class="anchor"></a>convenient wrapper for merging</h2>
<p>To ease the process of merging large number of batches of experiments, here is some <strong>internal wrappers</strong> to make it <strong>semi-automated</strong>.</p>
<div id="grouping-by-tree-structures" class="section level3">
<h3 class="hasAnchor">
<a href="#grouping-by-tree-structures" class="anchor"></a>Grouping by tree structures</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">gs1</span>, <span class="va">gs2</span>, <span class="va">gs3</span>, <span class="va">gs4</span>, <span class="va">gs5</span><span class="op">)</span>
<span class="va">gs_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs_split_by_tree.html">gs_split_by_tree</a></span><span class="op">(</span><span class="va">gslist</span><span class="op">)</span></code></pre></div>
<pre><code>## Grouping by Gating tree...</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/length.html">length</a></span><span class="op">(</span><span class="va">gs_groups</span><span class="op">)</span></code></pre></div>
<p>[1] 4</p>
<p>This divides all the <code>GatingSet</code>s into different groups, each group shares the same tree structure. Here we have <code>4</code> groups, ## Check if the discrepancy can be resolved by dropping leaf nodes</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html">try</a></span><span class="op">(</span><span class="fu"><a href="../reference/gs_check_redundant_nodes.html">gs_check_redundant_nodes</a></span><span class="op">(</span><span class="va">gs_groups</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>[1] “Error in (function (thisNodeSet, thisObj) : Can’t drop the non-terminal nodes: singlets”</p>
<p>Apparently the non-leaf node (<code>singlets</code>) fails this check, and it is up to user to decide whether to hide this node or keep this group separate from further merging.Here we try to hide it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">gp</span> <span class="kw">in</span> <span class="va">gs_groups</span><span class="op">)</span>
  <span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">gp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-12-1.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-12-2.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-12-3.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-12-4.png" width="384"></p>
<p>Based on the tree structure of each group (usually there aren’t as many groups as <code>GatingSet</code> objects itself), we will hide <code>singlets</code> for <code>group 2</code> and <code>group 4</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">gs</span> <span class="kw">in</span> <span class="va">gs_groups</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/gs_pop_set_visibility.html">gs_pop_set_visibility</a></span><span class="op">(</span><span class="va">gs</span>, <span class="st">"singlets"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now check again with <code>.gs_check_redundant_nodes</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toRm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gs_check_redundant_nodes.html">gs_check_redundant_nodes</a></span><span class="op">(</span><span class="va">gs_groups</span><span class="op">)</span>
<span class="va">toRm</span></code></pre></div>
<p>[[1]] [1] “CCR7+ 45RA+” “CCR7+ 45RA-”</p>
<p>[[2]] [1] “DNT” “DPT”</p>
<p>[[3]] character(0)</p>
<p>[[4]] character(0)</p>
<p>Based on this, these groups can be consolidated by dropping * <code>CCR7+ 45RA+</code> and <code>CCR7+ 45RA-</code> from <code>group 1</code>. * <code>DNT</code> and <code>DPT</code> from <code>group 2</code>.</p>
<p>Sometime it could be difficult to inspect and distinguish tree difference by simply plotting the enire gating tree or looking at this simple flat list of nodes (especially when the entire subtree is missing from cerntain groups). It is helpful to visualize and highlight only the tree hierarchy difference with the helper function <code>gs_plot_diff_tree</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gs_plot_diff_tree.html">gs_plot_diff_tree</a></span><span class="op">(</span><span class="va">gs_groups</span><span class="op">)</span></code></pre></div>
<p><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-15-1.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-15-2.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-15-3.png" width="384"><img src="HowToMergeGatingSet_files/figure-html/unnamed-chunk-15-4.png" width="384"></p>
<p>To proceed the deletion of these nodes, <code>.gs_remove_redundant_nodes</code> can be used instead of doing it manually</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gs_remove_redundant_nodes.html">gs_remove_redundant_nodes</a></span><span class="op">(</span><span class="va">gs_groups</span>, <span class="va">toRm</span><span class="op">)</span></code></pre></div>
<pre><code>## Removing CCR7+ 45RA+</code></pre>
<pre><code>## Removing CCR7+ 45RA-</code></pre>
<pre><code>## Removing DNT</code></pre>
<pre><code>## Removing DPT</code></pre>
<p>Now they can be merged into a single <code>GatingSetList</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/GatingSetList-class.html">GatingSetList</a></span><span class="op">(</span><span class="va">gslist</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: 'GatingSetList' is deprecated.
## Use 'merge_list_to_gs' instead.
## See help("Deprecated")</code></pre>
<p>An GatingSetList with 5 GatingSet containing 5 unique samples.</p>
</div>
</div>
<div id="remove-the-redundant-channels-from-gatingset" class="section level2">
<h2 class="hasAnchor">
<a href="#remove-the-redundant-channels-from-gatingset" class="anchor"></a>Remove the redundant channels from <code>GatingSet</code>
</h2>
<p>Sometime there may be the extra <code>channels</code> in one data set that prevents it from being merged with other. If these channels are not used by any gates, then they can be safely removed.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gs_remove_redundant_channels.html">gs_remove_redundant_channels</a></span><span class="op">(</span><span class="va">gs1</span><span class="op">)</span></code></pre></div>
<pre><code>## drop FSC-H, FSC-W, &lt;G560-A&gt;, &lt;G780-A&gt;, Time</code></pre>
<p>A GatingSet with 1 samples</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Greg Finak,Mike Jiang <wjiang2>,Jake Wagner <jpwagner>.</jpwagner></wjiang2></p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
